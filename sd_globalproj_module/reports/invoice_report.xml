<?xml version="1.0" encoding="utf-8"?>
<openerp>
	<data>
		<template id="sd_inherit_report_invoice" inherit_id="account.report_invoice_document">

			<xpath expr="//div[@class='page']" position="attributes">
				<attribute name="style">font-size:13px</attribute>
			</xpath>
			
			<xpath expr="//div/div/div[@class='col-xs-5 col-xs-offset-7']" position="replace">
				<div class="col-xs-4 col-xs-offset-4" style="font-size:16px">
					<strong>
						<span t-if="o.type == 'out_invoice' and (o.state == 'open' or o.state == 'paid')">Invoice</span>
						<span t-if="o.type == 'out_invoice' and o.state == 'proforma2'">PRO-FORMA</span>
						<span t-if="o.type == 'out_invoice' and o.state == 'draft'">Draft Invoice</span>
						<span t-if="o.type == 'out_invoice' and o.state == 'cancel'">Cancelled Invoice</span>
						<span t-if="o.type == 'out_refund'">Refund</span>
						<span t-if="o.type == 'in_refund'">Supplier Refund</span>
						<span t-if="o.type == 'in_invoice'">Supplier Invoice</span>
						<span t-field="o.number" />
					</strong>
					<t t-set="DESCUENTO" t-value="0" />
					<t t-foreach="o.invoice_line" t-as="l">
						<t t-if="l.discount > 0">
							<t t-set="DESCUENTO" t-value="1" />
						</t>
					</t>
				</div>
				<div>
					<div class="col-xs-8" style="min-height:80px;">
						<strong>
							<div t-if="o.company_id.partner_id.nif_company_group and o.number and 'FO' in o.number">
								Código de agrupación de empresas: 
								<span t-field="o.company_id.partner_id.nif_company_group"/>
							</div>
							<div t-if="o.date_invoice">
								Date invoice:
								<span t-field="o.date_invoice" />
							</div>
							<div t-if="o.origin">
								Origin:
								<span t-field="o.origin" />
							</div>
							<div t-if="o.partner_id.ref">
								Customer Code:
								<span t-field="o.partner_id.ref" />
							</div>
							<div t-if="o.reference">
								Reference:
								<span t-field="o.reference" />
							</div>
							<div t-if="o.name">
								Description:
								<span t-field="o.name" />
							</div>
						</strong>
					</div>
					<div class="col-xs-pull-11">
						<div>	
							<strong>
								Customer data
							</strong>
						</div>
						<div t-if="o.partner_id.name">
							<strong>Fiscal name: </strong>
							<span t-field="o.partner_id.name" />
						</div>
						<div t-if="o.partner_id.comercial">
							<strong>Comercial name: </strong>
							<span t-field="o.partner_id.comercial" />
						</div>
						<div t-if="o.partner_id.vat">
							<strong>NIF: </strong>
							<span t-field="o.partner_id.vat" />
						</div>
						<div t-if="o.partner_id.street or o.partner_id.zip or o.partner_id.city or o.partner_id.country_id">
							<strong>Dirección: </strong>
							<t t-if="o.partner_id.street">
								<span t-field="o.partner_id.street"/>
								<span t-if="o.partner_id.zip">,</span>
								<span t-if="not o.partner_id.zip and o.partner_id.city">,</span>
								<span t-if="not o.partner_id.zip and not o.partner_id.city and o.partner_id.country_id">,</span>
							</t>
							<t t-if="o.partner_id.zip">
								CP: <span t-field="o.partner_id.zip"/>
								<span t-if="o.partner_id.city">,</span>
								<span t-if="not o.partner_id.city and o.partner_id.country_id">,</span>
							</t>
							<t t-if="o.partner_id.city">
								<span t-field="o.partner_id.city"/>
								<span t-if="o.partner_id.country_id">,</span>
							</t>
							<t t-if="o.partner_id.country_id">
								<span t-field="o.partner_id.country_id.name"/>
							</t>
						</div>
					</div>
				</div>
			</xpath>

			<xpath expr="//div/div[@class='row mt32 mb32']" position="replace" />

			<xpath expr="//div/h2" position="replace" />
			
			<xpath expr="//thead/tr/th[@groups='sale.group_discount_per_so_line']" position="before">
				<t t-if="DESCUENTO">
					<th class="text-right" groups="sale.group_discount_per_so_line">Discount (%)</th>
				</t>
			</xpath>
			
			<xpath expr="//thead/tr/th[@groups='sale.group_discount_per_so_line']" position="replace"/>
			
			<!-- <xpath expr="//tbody/tr/td[@groups='sale.group_discount_per_so_line']" position="before">
				<t t-if="DESCUENTO">
					<td class="text-right" groups="sale.group_discount_per_so_line">
						<span t-field="l.discount"/>%
					</td>
				</t>
			</xpath>

			<xpath expr="//tbody/tr/td[@groups='sale.group_discount_per_so_line']" position="replace"/> -->
			<xpath expr="//tbody[@class='invoice_tbody']/tr[@t-foreach='o.invoice_line']" position="replace">
				<tr t-foreach="o.invoice_line" t-as='l'>
					<td><span t-field="l.name"/></td>
	                <td>
	                	<t t-if="l.quantity">
			                <span t-field="l.quantity"/>
			                <span t-field="l.uos_id" groups="product.group_uom"/>
			            </t>
	                </td>
	                <td class="text-right">
	                	<t t-if="l.quantity">
	                		<span t-field="l.price_unit"/>
	                	</t>
	                </td>
	                <td class="text-right" groups="sale.group_discount_per_so_line">
	                	<t t-if="l.quantity">
	                		<t t-if="DESCUENTO">
	                			<span t-field="l.discount"/>
	                		</t>
	                	</t>
	                </td>
	                <td class="text-right">
	                	<t t-if="l.quantity">
	                		<span t-esc="', '.join(map(lambda x: x.name, l.invoice_line_tax_id))"/>
	                	</t>
	                </td>
	                <td class="text-right">
	                	<t t-if="l.quantity">
	                		<span t-field="l.price_subtotal" t-field-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: &quot;o.currency_id&quot;}"/>
	                	</t>
	                </td>
				</tr>
			</xpath>
			
			<xpath expr="//p[@t-if='o.comment']" position="after">
				<p>
					<strong>Forma de pago: </strong>
					<span>Transferencia bancaria a la cuenta siguiente: </span>
					<span t-if="o.company_id.bank_ids" t-foreach="o.company_id.bank_ids" t-as="c">
						<span t-field="c.bank_name" />
						<span t-field="c.acc_number" />
					</span>
				</p>			
			</xpath>
			<xpath expr="//div[@class='page']" position="inside">
				<t t-if="o.invoice_template_id">
					<p style="page-break-after:always;"></p><!-- Salto de pagina  -->
					<span t-field="o.invoice_template_id.template"/>
				</t>
			</xpath>

		</template>
		
		<record id="sd_inherit_report_invoice" model="ir.ui.view">
			<field name="priority">20</field>
		</record>
		
	</data>
</openerp>