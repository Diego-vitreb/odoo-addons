<openerp>
	<data>
        <!-- PROYECTOS usuarios Desarrollo -->       
        <record id="desarrollo_action_view_task" model="ir.actions.act_window">
            <field name="name">Tareas Desarrollo</field>
            <field name="res_model">project.task</field>
            <field name="view_mode">kanban,tree,form,calendar,gantt,graph</field>
            <field name="search_view_id" ref="project.view_task_search_form"/>
            <field name="context">{'default_user_id': uid, 'search_default_user_id': uid}</field>
            <field name="domain" eval="[('project_id.parent_id.name','ilike','Desarrollo'),'|',('stage_id.sequence', '&lt;', 19),('stage_id.sequence','&gt;',39)]"/>
        </record>
		<menuitem action="desarrollo_action_view_task" id="desarrollo_menu_action_view_task" parent="project.menu_project_management" sequence="5" groups="sd_sdatos_module.sd_development_group"/>
		
		<!-- PROYECTOS usuarios técnicos -->
		<menuitem action="project.action_view_task" id="project.menu_action_view_task" parent="project.menu_project_management" sequence="5" groups="sd_sdatos_module.sd_management_group,sd_sdatos_module.sd_administration_group"/>
		
                 
		<record id="inherit_view_task_kanban" model="ir.ui.view">
			<field name="name">inherit.view.task.kanban</field>
			<field name="model">project.task</field>
			<field name="inherit_id" ref="project.view_task_kanban" />
			<field name="arch" type="xml">
				<xpath expr="//div[@class='oe_kanban_content']/div" position="before">
					<div>Nº: <field name="id"/></div>
				</xpath>
			</field>
		</record>
		<record id="inherit_view_task_form2" model="ir.ui.view">
			<field name="name">project.task.form.inherit</field>
			<field name="model">project.task</field>
			<field name="inherit_id" ref="project.view_task_form2" />
			<field name="arch" type="xml">
				<xpath expr="//header/field[@name='stage_id']" position="before">
	            	<button name="action_task_sent" type="object" string="Send by Email" class="oe_highlight" groups="base.group_user"/>
                </xpath>
				<xpath expr="//field[@name='categ_ids']" position="attributes">
					<attribute name="string">Servicio</attribute>				
				</xpath>
				<xpath expr="//field[@name='date_deadline']" position="before">
					<field name="id" string="Parte Nº"/>	
					<!-- <field name="groups"/>	 -->		
				</xpath>
	   	 	</field>
	   	 </record>
		 <record id="inherit_sign_view_task_form2" model="ir.ui.view">
			<field name="name">project.task.sign.form.inherit</field>
			<field name="model">project.task</field>
			<field name="inherit_id" ref="sd_digital_sign.inherit_view_task_form2" />
			<field name="arch" type="xml">
				<xpath expr="//field[@name='signature_image']" position="after">
					<field name="signature_client"/>				
				</xpath>
				<xpath expr="//div[@class='col-xs-offset-9']" position="attributes">
					<attribute name="class">col-xs-offset-0</attribute>
				</xpath>
	   	 	</field>
	   	 </record>
	   	 
	   	 <template id="inherit_project_report" inherit_id="sd_print_project_work.sd_project_report_document">
	   	 	<xpath expr="//h4" position="after">
	   	 		<strong>Servicio: </strong>
				<t t-if="l.categ_ids">
					<t t-foreach="l.categ_ids" t-as="a">
						<t t-if="a.name == 'TA'">
							<t t-set="total_TA" t-value="total_TA + 1"/>
						</t>
						<t t-if="a.name == 'TB'">
							<t t-set="total_TB" t-value="total_TB + 1"/>
						</t>
						<t t-if="a.name == 'TC'">
							<t t-set="total_TC" t-value="total_TC + 1"/>
						</t>
						<t t-esc="'%s, ' % a.name" />
					</t>
					<br />
				</t>
	   	 	</xpath>
	   	 	<xpath expr="//tr[@t-foreach='l.material_ids']" position="inside">
	   	 		<t t-if="w.product_id.name == 'Desplazamiento'">
	   	 			<t t-set="total_DESPLAZAMIENTO" t-value="total_DESPLAZAMIENTO + w.quantity"/>
	   	 		</t>
	   	 	</xpath>
	   	 	<xpath expr="//div/div/t[@t-value='abs(total_horas)']" position="after">
	   	 		<span t-esc="'Tipo A:%s' % total_TA"/>, Tipo B: <span t-esc="total_TB"/>, Tipo C: <span t-esc="total_TC"/>
	   	 		<br>Incidencias consumidas: <span t-esc="total_TA+total_TB*2+total_TC*3"/></br>
	   	 		<br>Total tiempo de desplazamiento: <span t-esc="'%s:%s' % (str('%.2d' % total_DESPLAZAMIENTO).split('.')[0], (str('%.2d' % int(float(str('%.2f' % total_DESPLAZAMIENTO).split('.')[1])/100*60))))"/></br><br/>
	   	 	</xpath>
	   	 </template>
	
		<template id="inherit_task_report"
			inherit_id="sd_print_project_work.sd_project_task_report_document">
			<xpath expr="//div[@class='page']" position="replace">
				<div class="page">
					<h2 class="text-center">Working part <span t-esc="'Nº: %.5d' % o.id"/></h2>
					<p style="font-size:14px">
						<br>
							<strong>Customer:</strong>
						</br>
						<span t-field="o.partner_id.name" />
						<br />
						<strong>Employee:</strong>
						<span t-field="o.user_id" />
						<br />
					</p>
					<div style="font-size:14px">
						<strong>Title of task: </strong>
						<span t-field="o.name" />
						<br />
						<strong>Labels: </strong>
						<t t-if="o.categ_ids">
							<t t-foreach="o.categ_ids" t-as="a">
								<t t-esc="'%s, ' % a.name" />
							</t>
							<br />
						</t>
						<strong>Office: </strong>
						<t t-if="o.office">
							<span t-field="o.office" />
						</t>
						<br/>
						<t t-if="o.description">
							<br>
								<u>Description</u>
							</br>
							<br />

							<span t-field="o.description" />
						</t>

					</div>
					<br />
					<t t-if="o.work_ids">
						<table class="table table-condensed">
							<thead>
								<tr style="font-size:14px">
									<th class="col-xs-7">Work</th>
									<th class="col-xs-1 text-center">Time in</th>
									<th class="col-xs-1 text-center">Time spent</th>
									<th class="col-xs-2 text-center">Date</th>
								</tr>
							</thead>
							<tbody class="invoice_tbody">

								<tr t-foreach="o.work_ids" t-as="l" style="font-size:14px">
									<td class="col-xs-7">
										<span t-field="l.name" />
									</td>
									<td class="col-xs-1 text-center">
										<span t-field="l.date" t-field-options="{&quot;format&quot;: &quot;HH:mm&quot;}" />
									</td>
									<td class="col-xs-1 text-center">
										<span
											t-esc="'%s:%s' % (str('%.2d' % l.hours).split('.')[0], (str('%.2d' % int(float(str('%.2f' % l.hours).split('.')[1])/100*60))))" />
									</td>
									<td class="col-xs-2 text-center">
										<span t-field="l.date"
											t-field-options="{&quot;format&quot;: &quot;dd-MM-yyyy&quot;}" />
									</td>
								</tr>

							</tbody>
						</table>
					</t>
					<t t-if="o.material_ids">
						<table class="table table-condensed">
							<thead>
								<tr style="font-size:14px">
									<th class="col-xs-4">Element/Component</th>
									<th class="col-xs-6">Description</th>
									<th class="col-xs-2 text-center">Quantity</th>
								</tr>
							</thead>
							<tbody class="invoice_tbody">

								<tr t-foreach="o.material_ids" t-as="w" style="font-size:14px">
									<td class="col-xs-4">
										<span t-field="w.product_id" />
									</td>
									<td class="col-xs-6">
										<span t-field="w.product_description" />
									</td>
									<td class="col-xs-2 text-center">
										<span t-esc="'%.2f ' % w.quantity" />
										<span t-esc="'%s' % w.product_id.uom_id.name" />
									</td>
								</tr>

							</tbody>
						</table>
					</t>
					<div class="row mt64 mb8 col-xs-offset-0" style="font-size:10px">
						<p>
							Para cualquier incidencia envíe un correo a:
							<b>incidencias@sdatos.es</b>
						</p>
					</div>
					<t t-if="o.signature_image">
						<div class="row mt128 mb8 pull-right">
							<h4>Customer Signature</h4>
							<img t-att-src="'data:image/png;base64,%s' % o.signature_image"
								style="max-height: 80px;"/>
							<br><span t-field="o.signature_client" style="font-size:10px"/></br>
						</div>
					</t>
				</div>
			</xpath>
		</template>
	</data>
</openerp>